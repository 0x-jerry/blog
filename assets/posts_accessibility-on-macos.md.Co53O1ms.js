import{_ as i,a,o as n,a5 as t}from"./chunks/framework.C9WMzgTl.js";const y=JSON.parse('{"title":"macOS 上的 Accessibility","description":"","frontmatter":{"title":"macOS 上的 Accessibility","date":"2025-03-25T01:56:44.118Z","tags":["macOS","accessibility","rust"],"read":{"text":"5 min read","minutes":4.535,"time":272100,"words":907}},"headers":[{"level":2,"title":"上下文","slug":"上下文","link":"#上下文","children":[]},{"level":2,"title":"Accessibility 的坑","slug":"accessibility-的坑","link":"#accessibility-的坑","children":[]},{"level":2,"title":"结语","slug":"结语","link":"#结语","children":[]}],"relativePath":"posts/accessibility-on-macos.md","filePath":"posts/accessibility-on-macos.md"}'),h={name:"posts/accessibility-on-macos.md"};function k(l,s,e,p,r,d){return n(),a("div",null,s[0]||(s[0]=[t(`<blockquote><p>本文记录一个在 macOS 上获取选中文本的坑，以此方便后来之人</p></blockquote><h2 id="上下文" tabindex="-1">上下文 <a class="header-anchor" href="#上下文" aria-label="Permalink to &quot;上下文&quot;">​</a></h2><p>最近在写一个应用，其中一个核心功能就是获取鼠标选中的文本，最开始探索了一圈，普遍的实现方式，都是通过 Accessibility 获取聚焦的元素，进而获取选中的文本。 备用方案则是通过模拟复制操作，再通过粘贴板获取对应的文本。但是备用方案在 macOS 上有两个缺点：</p><ol><li>污染粘贴板</li><li>在视觉上，会触发 macOS 上的顶部菜单栏高亮一下</li></ol><p>基于以上两个缺点，所以尽量不要用备用方案。</p><h2 id="accessibility-的坑" tabindex="-1">Accessibility 的坑 <a class="header-anchor" href="#accessibility-的坑" aria-label="Permalink to &quot;Accessibility 的坑&quot;">​</a></h2><p>macOS 上获取 accessibility 相关的 api 为 <a href="https://developer.apple.com/documentation/applicationservices/axuielement_h?language=objc" target="_blank" rel="noreferrer">AXUIElement.h</a>，目前已有的方案如 <a href="https://github.com/yetone/get-selected-text" target="_blank" rel="noreferrer">get-selected-text</a>，其核心代码如下：</p><div class="language-rs vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki shiki-themes vitesse-dark vitesse-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">use</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;"> accessibility_ng</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">{</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">AXAttribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> AXUIElement</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">};</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">use</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;"> accessibility_sys_ng</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">{</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#393A34;">kAXFocusedUIElementAttribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#393A34;"> kAXSelectedTextAttribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">fn</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;"> get_selected_text_by_ax</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;"> -&gt;</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> Result</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">&lt;</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">String</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> Box</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">&lt;</span><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">dyn</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> std</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">error</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">Error</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">&gt;&gt;</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> {</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">    let</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> system_element</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> =</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> AXUIElement</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">system_wide</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">();</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">    let</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> Some</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">selected_element</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">)</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> system_element</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">attribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">&amp;</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">AXAttribute</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">&amp;</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">CFString</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">from_static_string</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#393A34;">            kAXFocusedUIElementAttribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">        )))</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">map</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">|</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">element</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">|</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> element</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">downcast_into</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">&lt;</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">AXUIElement</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">&gt;())</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">ok</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">flatten</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">    else</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> {</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">        return</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> Err</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">Box</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">std</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">io</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">Error</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">            std</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">io</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">ErrorKind</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">NotFound</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">            &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#B56959;">No selected element</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">        )));</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">    };</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">    let</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> Some</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">selected_text</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">)</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> =</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> selected_element</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">attribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">&amp;</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">AXAttribute</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">&amp;</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">CFString</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">from_static_string</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#393A34;">            kAXSelectedTextAttribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">        )))</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">map</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">|</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">text</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">|</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> text</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">downcast_into</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">&lt;</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">CFString</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">&gt;())</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">ok</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">        .</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">flatten</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">    else</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> {</span></span>
<span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">        return</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> Err</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">Box</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">std</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">io</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">Error</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">            std</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">io</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">ErrorKind</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">NotFound</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">            &quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#B56959;">No selected text</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">        )));</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">    };</span></span>
<span class="line"><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;">    Ok</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">selected_text</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">to_string</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">())</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">}</span></span></code></pre></div><p><code>accessibility_ng</code> 和 <code>accessibility_sys_ng</code> 是对 <a href="https://developer.apple.com/documentation/applicationservices/axuielement_h?language=objc" target="_blank" rel="noreferrer">AXUIElement.h</a> 相关 api 的 <a href="https://www.rust-lang.org/" target="_blank" rel="noreferrer">rust</a> 绑定，核心原理倒是挺简单的， 但在实际使用过程中，却经常遇到错误 <a href="https://developer.apple.com/documentation/applicationservices/axerror/kaxerrorcannotcomplete" target="_blank" rel="noreferrer">AXError(-25204)</a> 和 <a href="https://developer.apple.com/documentation/applicationservices/axerror/kaxerrornovalue" target="_blank" rel="noreferrer">AXError(25212)</a>，本以为是很常见的错误，又在网上搜索了一波， 但却很遗憾的没有得到解决。那这个时候，不就应该是 AI 发力的时候了嘛！遗憾的是，AI 给的解决方案也都大同小异，和以上代码差不多，并不能解决问题。</p><p>幸运的是，最近偶然发现了一款软件，名为 <a href="https://www.popclip.app/" target="_blank" rel="noreferrer">PopClip</a>，在使用的过程中，其可以流畅的获取选中的文本，而且有一个很奇怪的现象：如果我先用 PopClip 在某个软件中 触发一次 PopClip 的悬浮窗口，那么再执行上述 rust 代码，就能正常获取到选中的文本，即使后面关闭 PopClip，也能正常获取选中的文本，但如果我重新打开一次某个应用， 上述 rust 代码就再次失效。真实个奇怪的现象 🤔。于是猜测，这其中一定有针对进程的某个开关。无奈的是，靠着现有搜索引擎搜索了一圈，并无解决方案。</p><p>中间尝试了各种方案，也用 swift 写了一版对应的代码，结果都是一样，都是错误 <a href="https://developer.apple.com/documentation/applicationservices/axerror/kaxerrorcannotcomplete" target="_blank" rel="noreferrer">AXError(-25204)</a> 和 <a href="https://developer.apple.com/documentation/applicationservices/axerror/kaxerrornovalue" target="_blank" rel="noreferrer">AXError(25212)</a>。</p><p>最后还是在 Github 上直接搜索 <a href="https://developer.apple.com/documentation/applicationservices/axuielement_h?language=objc" target="_blank" rel="noreferrer">AXUIElement.h</a> api 相关的代码，最后找到了一个代码片段 <a href="https://github.com/stritefax/heelixchat/blob/8aadc34bff78717b1f8a0429f34ee01f8ecf5d7b/src-tauri/src/window_details_collector/macos/macos_accessibility_engine.rs#L131-L153" target="_blank" rel="noreferrer">#L131-L153</a>：</p><div class="language-rs vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki shiki-themes vitesse-dark vitesse-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;">unsafe</span><span style="--shiki-dark:#4D9375;--shiki-light:#1E754F;"> fn</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;"> configure_application</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">application</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">:</span><span style="--shiki-dark:#5DA994;--shiki-light:#2E8F82;"> AXUIElementRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">)</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> {</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">    AXUIElementSetMessagingTimeout</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">application</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span><span style="--shiki-dark:#4C9A91;--shiki-light:#2F798A;"> 5</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">.</span><span style="--shiki-dark:#4C9A91;--shiki-light:#2F798A;">0</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">);</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">    AXUIElementCopyAttributeValue</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">        application</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        CFString</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#DBD7CAEE;--shiki-light:#393A34;">kAXFocusedApplicationAttribute</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">)</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">as_concrete_TypeRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        ptr</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">null_mut</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">    );</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">    let</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> _</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> =</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;"> AXUIElementSetAttributeValue</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">        application</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        CFString</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#B56959;">AXInspectorEnabled</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">)</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">as_concrete_TypeRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        CFBoolean</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">true_value</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">as_CFTypeRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">    );</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">    let</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> _</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> =</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;"> AXUIElementSetAttributeValue</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">        application</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        CFString</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#B56959;">AXEnhancedUserInterface</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">)</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">as_concrete_TypeRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        CFBoolean</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">true_value</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">as_CFTypeRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">    );</span></span>
<span class="line"><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">    let</span><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;"> _</span><span style="--shiki-dark:#666666;--shiki-light:#999999;"> =</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;"> AXUIElementSetAttributeValue</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span></span>
<span class="line"><span style="--shiki-dark:#BD976A;--shiki-light:#B07D48;">        application</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">,</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        CFString</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">new</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#C98A7D;--shiki-light:#B56959;">AXManualAccessibility</span><span style="--shiki-dark:#C98A7D77;--shiki-light:#B5695977;">&quot;</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">)</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">as_concrete_TypeRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">        CFBoolean</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">::</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">true_value</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">()</span><span style="--shiki-dark:#CB7676;--shiki-light:#AB5959;">.</span><span style="--shiki-dark:#80A665;--shiki-light:#59873A;">as_CFTypeRef</span><span style="--shiki-dark:#666666;--shiki-light:#999999;">(),</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">    );</span></span>
<span class="line"><span style="--shiki-dark:#666666;--shiki-light:#999999;">}</span></span></code></pre></div><p>上述代码中，主要是设置了 <code>AXEnhancedUserInterface</code> 和 <code>AXManualAccessibility</code> 这两个属性，我尝试了一下上述代码，问题就这么解决了！</p><h2 id="结语" tabindex="-1">结语 <a class="header-anchor" href="#结语" aria-label="Permalink to &quot;结语&quot;">​</a></h2><p>之后搜索了一下 <code>AXEnhancedUserInterface</code> 和 <code>AXManualAccessibility</code> 这两个属性是作用是什么，却没有找到很官方的文档，但相关的文章大多都指出， 这两个属性可以让应用开启 Accessibility 相关能力，如果不设置的话，应用默认应该是关闭的。因此才会经常遇到 <a href="https://developer.apple.com/documentation/applicationservices/axerror/kaxerrorcannotcomplete" target="_blank" rel="noreferrer">AXError(-25204)</a> 和 <a href="https://developer.apple.com/documentation/applicationservices/axerror/kaxerrornovalue" target="_blank" rel="noreferrer">AXError(25212)</a> 这两个错误。</p><p>就这么一个问题，如果有正式的文档，也不至于前前后后花费约两周的时间才处理掉问题，哎，这也证明了文档是多么的重要！罢了罢了，这个问题就到此为止吧！</p>`,17)]))}const A=i(h,[["render",k]]);export{y as __pageData,A as default};
